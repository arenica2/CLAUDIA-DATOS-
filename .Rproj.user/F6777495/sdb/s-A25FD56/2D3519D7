{
    "collab_server" : "",
    "contents" : "#################################\n#\n# Autor: Gian Franco\n#\n# OBTENER DATOS DE DE LA BASE DE DATOS DE MINSA (FOXPRO)\n######################\n\n  #-RUTAS UTILIZADAS\n    ruta_1 <- '/home/gianfranco/Documentos/github/Participation/bd_minsa/bd'\n\n#-------------------------------------------------------------------\n#============ Funcion CreateUnicode =========================================\n# Solo si la data tiene la columna \"CODCNSLDD\"\n#--------------------------------------------------------------------\n  CreateUnicode<-function(data) {\n    #Esta funcion retorna un data frame con los con el UNICODE\n    #\n    #ARGS\n    # data = La base donde se desea obtener el UNICODE\n    #\n    #RETURNS\n    # data = Con las columnas UNICODE, P, D, L, V al inicio del dataframe\n    #\n    \n    #Separando en \"P\", \"D\", \"L\" y \"V\"\n      data$P<-substr(data$CODCNSLDD,1,1)\n      data$D<-substr(data$CODCNSLDD,2,3)\n      data$L<-substr(data$CODCNSLDD,4,5)\n      data$V<-data$CODIGO\n      \n    #Eliminado espacios en blanco\n      data$D <- gsub(\" \",\"\",data$D, fixed = T)\n      data$L <- gsub(\" \",\"\",data$L, fixed = T)\n      \n    #Contruyendo UNICODE\n      data$UNICODE<-paste(data$P, data$D, data$L, data$V, sep = \".\")\n    \n    #Ordenando Las columnas\n      n_col <- length(data)\n      data <- data[, c(n_col, n_col-4,n_col-3,n_col-2,n_col-1, 1:(n_col-5) )]\n    \n    return(data)\n  }\n#=========================================================================\n  \n#----------------------------------------------------------------------------\n#============ Funcion ELIMINAR DUPLICADOS UNICODE X STATUS ==================\n# Requerimientos:\n#   - Las bases de datos deben contener las columna \"UNICODE\", \"STATUS\", \"POS_CHIRI\"\n#--------------------------------------------------------------------\n  ElimDupliUxS<-function(data) {\n    #Esta funcion retorna un data frame con los datos de unicode UNICOS poniendo en prioridad el STATUS de las viviendas \n    #(\"T\", \"R\", \"C\", \"DES\", \"LP\", \"LV\"), para con esto seleccionar el duplicado que debe quedar en el data.frame de respuesta\n    #\n    #ARGS\n    # data = Data frame conteniendo los datos\n    #\n    #RETURNS\n    # data_sindupli = Data frame sin duplicados\n    #\n    \n    #Obtenemos en un array todos los UNICODEs que son duplicados\n      uni_dupli <- unique(data$UNICODE[which(duplicated(data$UNICODE))])\n      \n    #Almacenamos en una variable los datos que NO contienen UNICODEs duplicados\n      data_sindupli <- data[!(data$UNICODE %in% uni_dupli),]\n    \n    #Almacenamos en una variable todos los registros que SI son duplicados\n      data_condupli <- data[data$UNICODE %in% uni_dupli,]\n      \n    #Trabajamos con los duplicados\n      #Dando prioridad a los UNICODEs que son tratadas(STATUS=1) y positivas (POS_CHIRI=1)\n        variable <- data_condupli[1 == data_condupli$STATUS & 1 == data_condupli$POS_CHIRI,]\n      #Juntamos solo las viviendas sin duplicados, dependiendo de la prioridad del STATUS (T, R, C, DES, LP, LV)\n        i <- 1\n        while (length(uni_dupli)) {\n          #Almacenamos los datos sin duplicados\n            data_sindupli <- rbind(data_sindupli,variable)\n          #Actualizando variables\n            uni_dupli <- setdiff(uni_dupli, variable$UNICODE)\n            x <- data[data$UNICODE %in% uni_dupli,]\n            data_condupli <- data_condupli[data_condupli$UNICODE %in% uni_dupli,]\n            variable <- data_condupli[i == data_condupli$STATUS,]\n            i <- i+1\n        }\n     \n    return(data_sindupli)\n  }\n#=========================================================================\n\n#install.packages (“foreign”) #Instalar el paquete que nos permite abrir archivos \".dbf\"\n  library(foreign) #Llamando al paquete\n\n#Ruta\n  setwd(ruta_1)\n\n#Obtenemos las bases que nos interesan\n  t_dist<- read.dbf(path.expand(\"control/t_dist.dbf\"), as.is = TRUE)#contiene los códigos y nombre de distritos, formulacion de insecticida\n  t_loc<- read.dbf(path.expand(\"control/t_loc.dbf\"), as.is = TRUE)#contiene nombre de localidades, codigo distrito, y nro de viv total de las loc\n  t_roc<- read.dbf(path.expand(\"control/t_roc.dbf\"), as.is = TRUE)#contiene códigos y nombres de los rociadores\n  t_mat<- read.dbf(path.expand(\"control/t_mat.dbf\"), as.is = TRUE)#contiene el código y el nombre de los materiales de las viviendas\n  td_cnsldd<- read.dbf(path.expand(\"control/td_cnsldd.dbf\"), as.is = TRUE)#tabla de consolidación donde se encuentra la mayoría de la información\n  th_cnsldd<- read.dbf(path.expand(\"control/th_cnsldd.dbf\"), as.is = TRUE)#contiene las fechas de rociado de las viviendas, ciclo de rociado \n\n#Eliminando inconsistencias en bases foxpro\n  t_dist<- t_dist[!grepl(\"00015\", t_dist$CODDIST, fixed = TRUE),]#Eliminamos duplicadado \"Cerro Colorado\"\n  t_loc<- t_loc[!grepl(\"00194\", t_loc$CODLOC, fixed = TRUE),]#Eliminamos \"Huanca-Murco\"\n  t_loc<- t_loc[!grepl(\"00195\", t_loc$CODLOC, fixed = TRUE),]#Eliminamos duplicadado \"Canco\"\n  t_loc<- t_loc[!grepl(\"00196\", t_loc$CODLOC, fixed = TRUE),]#Eliminamos \"Huambo-Canca\"\n  t_roc<- t_roc[!(grepl('00081', t_roc$CODROC, fixed = TRUE) & grepl('Pepe Quintanilla', t_roc$ROCIADOR, fixed = TRUE)),]#Eliminamos codigo \"00081\" con \"Pepe Quintanilla\" ya que se repite con otro codigo igual\n  t_roc<- t_roc[!grepl(\"Andy\", t_roc$ROCIADOR, fixed = TRUE),]#Eliminamos \"Andy Catacora\" nunca rocea\n\n#Reemplazando tildes\n  t_dist$INSECTICID<-enc2utf8(t_dist$INSECTICID)\n  t_dist$INSECTICID<- gsub(\"<ed>\",\"i\",t_dist$INSECTICID)#reemplazando la vocal \"i\"\n  t_loc$LOCALIDAD<- enc2utf8(t_loc$LOCALIDAD)\n  t_loc$LOCALIDAD<- gsub(\"<e1>\",\"a\",t_loc$LOCALIDAD)#reemplazando \"á\" por \"a\"\n  t_loc$LOCALIDAD<- gsub(\"<e9>\",\"e\",t_loc$LOCALIDAD)#reemplazando \"é\" por \"e\"\n  t_loc$LOCALIDAD<- gsub(\"<ed>\",\"i\",t_loc$LOCALIDAD)#reemplazando \"í\" por \"i\"\n  t_loc$LOCALIDAD<- gsub(\"<f3>\",\"o\",t_loc$LOCALIDAD)#reemplazando \"ó\" por \"o\"\n  t_loc$LOCALIDAD<- gsub(\"<fa>\",\"u\",t_loc$LOCALIDAD)#reemplazando \"ú\" por \"u\"\n  t_loc$LOCALIDAD<- gsub(\"<f1>\",\"ni\",t_loc$LOCALIDAD)#reemplazando \"ñ\" por \"ni\"\n  t_roc$ROCIADOR<- enc2utf8(t_roc$ROCIADOR)\n  t_roc$ROCIADOR<- gsub(\"<e1>\",\"a\",t_roc$ROCIADOR)#reemplazando \"á\" por \"a\"\n  t_roc$ROCIADOR<- gsub(\"<e9>\",\"e\",t_roc$ROCIADOR)#reemplazando \"é\" por \"e\"\n  t_roc$ROCIADOR<- gsub(\"<ed>\",\"i\",t_roc$ROCIADOR)#reemplazando \"í\" por \"i\"\n  t_roc$ROCIADOR<- gsub(\"<f3>\",\"o\",t_roc$ROCIADOR)#reemplazando \"ó\" por \"o\"\n  t_roc$ROCIADOR<- gsub(\"<fa>\",\"u\",t_roc$ROCIADOR)#reemplazando \"ú\" por \"u\"\n  t_roc$ROCIADOR<- gsub(\"<f1>\",\"ni\",t_roc$ROCIADOR)#reemplazando \"ñ\" por \"ni\"\n  t_mat$MATERIAL<- enc2utf8(t_mat$MATERIAL)\n  t_mat$MATERIAL<- gsub(\"<f3>\",\"o\",t_mat$MATERIAL)#reemplazando \"ó\" por \"o\"\n  td_cnsldd$JEFEVIV<- enc2utf8(td_cnsldd$JEFEVIV)\n  td_cnsldd$JEFEVIV<- gsub(\"<e1>\",\"a\",td_cnsldd$JEFEVIV)#reemplazando \"á\" por \"a\"\n  td_cnsldd$JEFEVIV<- gsub(\"<e9>\",\"e\",td_cnsldd$JEFEVIV)#reemplazando \"é\" por \"e\"\n  td_cnsldd$JEFEVIV<- gsub(\"<ed>\",\"i\",td_cnsldd$JEFEVIV)#reemplazando \"í\" por \"i\"\n  td_cnsldd$JEFEVIV<- gsub(\"<f3>\",\"o\",td_cnsldd$JEFEVIV)#reemplazando \"ó\" por \"o\"\n  td_cnsldd$JEFEVIV<- gsub(\"<fa>\",\"u\",td_cnsldd$JEFEVIV)#reemplazando \"ú\" por \"u\"\n  td_cnsldd$JEFEVIV<- gsub(\"<f1>\",\"ni\",td_cnsldd$JEFEVIV)#reemplazando \"ñ\" por \"ni\"\n  td_cnsldd$IN_MAT<- enc2utf8(td_cnsldd$IN_MAT)\n  td_cnsldd$IN_MAT<- gsub(\"<f3>\",\"o\",td_cnsldd$IN_MAT)#reemplazando \"ó\" por \"o\"\n  td_cnsldd$PE_MAT<- enc2utf8(td_cnsldd$PE_MAT)\n  td_cnsldd$PE_MAT<- gsub(\"<f3>\",\"o\",td_cnsldd$PE_MAT)#reemplazando \"ó\" por \"o\"\n\n#Seleccionado solo columnas con datos\n  distrito<- t_dist[,c(\"CODDIST\",\"DISTRITO\",\"CODIGO\",\"CODPRV\",\"CODNSTCD\",\"INSECTICID\")]\n  localidad<- t_loc[,c(\"CODLOC\",\"LOCALIDAD\",\"CODIGO\",\"NUMVIV\",\"CODDIST\",\"CODINT\")]\n  materiales<-t_mat[,c(\"CODMAT\",\"MATERIAL\")]\n  rociador<-t_roc[,c(\"CODROC\",\"ROCIADOR\",\"BOSSONOFF\")]\n  fecha_roc_minsa<-th_cnsldd[,c(\"NUMERO\",\"CODCNSLDD\",\"CODPRV\",\"CODDIST\",\"CODLOC\",\"CODROC\",\"CICLO\",\"FECHA\",\"CODNSTCD\",\"SAVED\",\"CODJEF\",\"INICIO\",\"FINAL\")]\n  cons_roc_minsa<-td_cnsldd[,c(\"CODCNSLDD\",\"CODIGO\",\"SEEKVIV\",\"CODVIV\",\"JEFEVIV\",\"NUMRES\",\"IN_AMB\",\"IN_MAT\",\"IN_GRI\",\"IN_TRI\",\"PE_AMB\",\"PE_MAT\",\"PE_GRI\",\"PE_TRI\",\"AN_TEC\",\"AN_PAT\",\"TRARES_T\",\"TRARES_RR\",\"CARGANSTCD\",\"SUPER\",\"NOTAS\",\"NUMREC\",\"IN_CODMAT\",\"PE_CODMAT\",\"CICLO\")]\n\n#---------------------------------------------------------------------#\n#-------                fecha_roc_minsa                      ---------#\n#---------------------------------------------------------------------#\n  #Separando la fecha\n    fecha_roc_minsa$FR_A<-format( fecha_roc_minsa$FECHA, format=\"%Y\" ) \n    fecha_roc_minsa$FR_M<-format( fecha_roc_minsa$FECHA, format=\"%m\" ) \n    fecha_roc_minsa$FR_D<-format( fecha_roc_minsa$FECHA, format=\"%d\" ) \n  #Merge entre \"fecha_roc_minsa\" y \"rociador\"\n    fecha<- merge(fecha_roc_minsa,rociador)\n    fecha<-fecha[,c(3,8,14:16,1,17,12,13)]\n\n#---------------------------------------------------------------------#\n#--------                  cons_roc_minsa                    ---------#\n#---------------------------------------------------------------------#\n  #Se selecciona solo los que tienen \"0\" los demas son sumatorias de este.\n    cons_roc_minsa<-cons_roc_minsa[0==cons_roc_minsa$NUMREC,]\n  \n  #Separando en \"P\", \"D\", \"L\" y \"V\"\n    cons_roc_minsa$P<-substr(cons_roc_minsa$CODCNSLDD,1,1)\n    cons_roc_minsa$D<-substr(cons_roc_minsa$CODCNSLDD,2,3)\n    cons_roc_minsa$L<-substr(cons_roc_minsa$CODCNSLDD,4,5)\n    cons_roc_minsa$V<-cons_roc_minsa$CODIGO\n  \n  #Eliminado espacios en blanco\n    cons_roc_minsa$D <- gsub(\" \",\"\",cons_roc_minsa$D, fixed = T)\n    cons_roc_minsa$L <- gsub(\" \",\"\",cons_roc_minsa$L, fixed = T)\n  \n  #Contruyendo UNICODE\n    cons_roc_minsa$UNICODE<-paste(cons_roc_minsa$P, cons_roc_minsa$D, cons_roc_minsa$L, cons_roc_minsa$V, sep = \".\")\n  \n  #Completando ciclos de rociado I y II\n    cons_roc_minsa$CICLO_ROCIADO<-substr(cons_roc_minsa$CODCNSLDD,8,8)#comprobado que salen bien\n  \n  #Creando columna \"MAS20TRI_IN\" y \"MAS20TRI_PE\"\n    cons_roc_minsa$MAS20TRI_IN<- unlist(0)\n    cons_roc_minsa$MAS20TRI_PE<- unlist(0)\n    cons_roc_minsa[grepl(\"+\",cons_roc_minsa$IN_TRI, fixed = TRUE),\"MAS20TRI_IN\"]<- 1\n    cons_roc_minsa[grepl(\"+\",cons_roc_minsa$PE_TRI, fixed = TRUE),\"MAS20TRI_PE\"]<- 1\n    \n  #Creando columnas de materiales en el INTRA y asignando su valor\n    cons_roc_minsa$IN_SIL<- unlist(0)\n    cons_roc_minsa$IN_NOB<- unlist(0)\n    cons_roc_minsa$IN_LAD<- unlist(0)\n    cons_roc_minsa$IN_ADO<- unlist(0)\n    cons_roc_minsa$IN_BLOQ<- unlist(0)\n    cons_roc_minsa[grepl(\"Sillar\",cons_roc_minsa$IN_MAT, fixed = TRUE),\"IN_SIL\"]<- 1\n    cons_roc_minsa[grepl(\"Noble\",cons_roc_minsa$IN_MAT, fixed = TRUE),\"IN_NOB\"]<- 1\n    cons_roc_minsa[grepl(\"Ladrillo\",cons_roc_minsa$IN_MAT, fixed = TRUE),\"IN_LAD\"]<- 1\n    cons_roc_minsa[grepl(\"Adobe\",cons_roc_minsa$IN_MAT, fixed = TRUE),\"IN_ADO\"]<- 1\n    cons_roc_minsa[grepl(\"Bloqueta\",cons_roc_minsa$IN_MAT, fixed = TRUE),\"IN_BLOQ\"]<- 1\n    \n  #Creando columnas de materiales en el PERI y asignando su valor\n    cons_roc_minsa$PE_SIL<- unlist(0)\n    cons_roc_minsa$PE_NOB<- unlist(0)\n    cons_roc_minsa$PE_LAD<- unlist(0)\n    cons_roc_minsa$PE_ADO<- unlist(0)\n    cons_roc_minsa$PE_BLOQ<- unlist(0)\n    cons_roc_minsa$PE_PIE<- unlist(0)\n    cons_roc_minsa[grepl(\"Sillar\",cons_roc_minsa$PE_MAT, fixed = TRUE),\"PE_SIL\"]<- 1\n    cons_roc_minsa[grepl(\"Noble\",cons_roc_minsa$PE_MAT, fixed = TRUE),\"PE_NOB\"]<- 1\n    cons_roc_minsa[grepl(\"Ladrillo\",cons_roc_minsa$PE_MAT, fixed = TRUE),\"PE_LAD\"]<- 1\n    cons_roc_minsa[grepl(\"Adobe\",cons_roc_minsa$PE_MAT, fixed = TRUE),\"PE_ADO\"]<- 1\n    cons_roc_minsa[grepl(\"Bloqueta\",cons_roc_minsa$PE_MAT, fixed = TRUE),\"PE_BLOQ\"]<- 1\n    cons_roc_minsa[grepl(\"Piedra\",cons_roc_minsa$PE_MAT, fixed = TRUE),\"PE_PIE\"]<- 1\n    \n  #Creando columnas de animales en el TECHO y asignando su valor\n    cons_roc_minsa$TEC_CUY<- unlist(0)\n    cons_roc_minsa$TEC_CON<- unlist(0)\n    cons_roc_minsa$TEC_OVE<- unlist(0)\n    cons_roc_minsa$TEC_PER<- unlist(0)\n    cons_roc_minsa$TEC_AVE<- unlist(0)\n    cons_roc_minsa$TEC_GAT<- unlist(0)\n    cons_roc_minsa[grepl(\"Cuyes\",cons_roc_minsa$AN_TEC, fixed = TRUE),\"TEC_CUY\"]<- 1\n    cons_roc_minsa[grepl(\"Conejos\",cons_roc_minsa$AN_TEC, fixed = TRUE),\"TEC_CON\"]<- 1\n    cons_roc_minsa[grepl(\"Ovejas\",cons_roc_minsa$AN_TEC, fixed = TRUE),\"TEC_OVE\"]<- 1\n    cons_roc_minsa[grepl(\"Perros\",cons_roc_minsa$AN_TEC, fixed = TRUE),\"TEC_PER\"]<- 1\n    cons_roc_minsa[grepl(\"Aves\",cons_roc_minsa$AN_TEC, fixed = TRUE),\"TEC_AVE\"]<- 1\n    cons_roc_minsa[grepl(\"Gatos\",cons_roc_minsa$AN_TEC, fixed = TRUE),\"TEC_GAT\"]<- 1\n    \n  #Creando columnas de animales en el PATIO y asignando su valor\n    cons_roc_minsa$PAT_CUY<- unlist(0)\n    cons_roc_minsa$PAT_CON<- unlist(0)\n    cons_roc_minsa$PAT_OVE<- unlist(0)\n    cons_roc_minsa$PAT_PER<- unlist(0)\n    cons_roc_minsa$PAT_AVE<- unlist(0)\n    cons_roc_minsa$PAT_GAT<- unlist(0)\n    cons_roc_minsa[grepl(\"Cuyes\",cons_roc_minsa$AN_PAT, fixed = TRUE),\"PAT_CUY\"]<- 1\n    cons_roc_minsa[grepl(\"Conejos\",cons_roc_minsa$AN_PAT, fixed = TRUE),\"PAT_CON\"]<- 1\n    cons_roc_minsa[grepl(\"Ovejas\",cons_roc_minsa$AN_PAT, fixed = TRUE),\"PAT_OVE\"]<- 1\n    cons_roc_minsa[grepl(\"Perros\",cons_roc_minsa$AN_PAT, fixed = TRUE),\"PAT_PER\"]<- 1\n    cons_roc_minsa[grepl(\"Aves\",cons_roc_minsa$AN_PAT, fixed = TRUE),\"PAT_AVE\"]<- 1\n    cons_roc_minsa[grepl(\"Gatos\",cons_roc_minsa$AN_PAT, fixed = TRUE),\"PAT_GAT\"]<- 1\n\n#CONSOLIDADO FINAL\n  CONS_ROCIADO_2009_2015<- merge(cons_roc_minsa, fecha)\n  CONS_ROCIADO_2009_2015<- CONS_ROCIADO_2009_2015[,c(30,26:29,57:60,62,5:8,34:38,9,10,32,11,12,39:44,13,14,33,15,45:50,16,51:56,31,19:21)]# Tener cuidado cuando las tablas cambien de tamanio ya que esta en numeros\n  #Obteniendo solo las filas que son unicas, eliminando duplicados de filas\n  CONS_ROCIADO_2009_2015<- unique(CONS_ROCIADO_2009_2015)# se eliminaron 1274 registros\n\n#Filtrando para que no se esté buscando localidades que no estan en el estudio en ASA\n  filtro<-function(dat,dentro)\n  {\n    filtrado<-dat[(1==dat$P & 1==dat$D & is.element(dat$L,dentro)==TRUE),]\n    return(filtrado)\n  }\n  dentro<-c(7,8,13,14,22,23,25,26,27,29,34,36,39,42,44,45,71,77,78,81,82,83)\n  #Aplicando funcion filtro\n  tratadas_ASA<-filtro(CONS_ROCIADO_2009_2015,dentro)\n\n#--------------------------------------------------------------------------------------\n# Solo que tengan las columnas UNICODE, CICLO y STATUS\n#--------------------------------------------------------------------------------------\n  #Cerradas \n    tdc_cnsldd<- read.dbf(path.expand(\"control/tdc_cnsldd.dbf\"), as.is = TRUE)\n  #Renuente\n    tdr_cnsldd<- read.dbf(path.expand(\"control/tdr_cnsldd.dbf\"), as.is = TRUE)\n  #Deshabitada \n    tdd_cnsldd<- read.dbf(path.expand(\"control/tdd_cnsldd.dbf\"), as.is = TRUE)\n  #Local publico\n    tdp_cnsldd<- read.dbf(path.expand(\"control/tdp_cnsldd.dbf\"), as.is = TRUE)\n  #Lote vacio\n    tdv_cnsldd<- read.dbf(path.expand(\"control/tdv_cnsldd.dbf\"), as.is = TRUE)\n  \n  #Utilizando la funcion CreateUnicode, para obtener los UNICODEs\n    tdc_cnsldd <- CreateUnicode(tdc_cnsldd)\n    tdr_cnsldd <- CreateUnicode(tdr_cnsldd)\n    tdd_cnsldd <- CreateUnicode(tdd_cnsldd)\n    tdp_cnsldd <- CreateUnicode(tdp_cnsldd)\n    tdv_cnsldd <- CreateUnicode(tdv_cnsldd)\n\n  # Obteniendo el ciclo de rociado real sacado de la columna CODCNSLDD\n    tdc_cnsldd$CICLO_ROCIADO<-substr(tdc_cnsldd$CODCNSLDD,8,8)\n    tdr_cnsldd$CICLO_ROCIADO<-substr(tdr_cnsldd$CODCNSLDD,8,8)\n    tdd_cnsldd$CICLO_ROCIADO<-substr(tdd_cnsldd$CODCNSLDD,8,8)\n    tdp_cnsldd$CICLO_ROCIADO<-substr(tdp_cnsldd$CODCNSLDD,8,8)\n    tdv_cnsldd$CICLO_ROCIADO<-substr(tdv_cnsldd$CODCNSLDD,8,8)\n  \n  #Creando una columna STATUS\n    tdc_cnsldd$STATUS <- unlist(\"C\")\n    tdr_cnsldd$STATUS <- unlist(\"R\")\n    tdd_cnsldd$STATUS <- unlist(\"DES\")\n    tdp_cnsldd$STATUS <- unlist(\"LP\")\n    tdv_cnsldd$STATUS <- unlist(\"LV\")\n    \n  #Obteniendo solo columna que necesito\n    tdc_cnsldd <- tdc_cnsldd[, c(1:5,19,20)]\n    tdr_cnsldd <- tdr_cnsldd[, c(1:5,19,20)]\n    tdd_cnsldd <- tdd_cnsldd[, c(1:5,19,20)]\n    tdp_cnsldd <- tdp_cnsldd[, c(1:5,19,20)]\n    tdv_cnsldd <- tdv_cnsldd[, c(1:5,19,20)]\n    \n  #Juntando \n    C_R <- merge(tdc_cnsldd,tdr_cnsldd, all = TRUE)\n    C_R_D <- merge(C_R,tdd_cnsldd, all = TRUE)\n    C_R_D_LP <- merge(C_R_D,tdp_cnsldd, all = TRUE)\n    C_R_D_LP_LV <-merge(C_R_D_LP,tdv_cnsldd, all = TRUE)\n  \n  #Obteniendo registros unicos de todos los registros de Arequipa\n    C_R_D_LP_LV <- unique(C_R_D_LP_LV)\n  \n  #Aplicando funcion filtro para obtener solo los datos del distrito ASA\n    statusMinsa<-filtro(C_R_D_LP_LV,dentro)\n    \n  #Juntando con las tratadas    \n    tratadas <- tratadas_ASA\n    tratadas$STATUS <- unlist(\"T\")\n    tratadas <- tratadas[,c(1:5,21,32,48,52)]\n    tratadas <- unique(tratadas)\n    \n  #Merge\n    statusMinsaASA <- merge(statusMinsa, tratadas, all = TRUE)\n  \n#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n#------------------       CONSOLIDADO GENERAL 2006 - 2015 MINSA        ------------------------ \n#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n  #Leer datos\n    cons2006_2009 <- read.csv(\"UNION_ROCIADOS.csv\")\n  \n  #Eliminado los que tienen \"0\" en la columna \"P\"\n    cons2006_2009 <- cons2006_2009[!(cons2006_2009$P==0),]\n  \n  #Eliminamos columna \"ID\"\n    cons2006_2009 <- subset(cons2006_2009, select = -ID)\n  #Cambiamos de nombre a la columna CICLO por CICLO_ROCIADO\n    colnames(cons2006_2009)[57] <- \"CICLO_ROCIADO\"\n  #Contruyendo UNICODE\n    cons2006_2009$UNICODE<-paste(cons2006_2009$P, cons2006_2009$D, cons2006_2009$L, cons2006_2009$V, sep = \".\")\n    cons2006_2009 <- cons2006_2009[,c(62,1:61)] # Ordenando columnas\n  #Eliminar espacios en blanco de la columna UNICODE\n    cons2006_2009$UNICODE <- gsub(\" \",\"\",cons2006_2009$UNICODE, fixed = T)\n    \n  #Convirtiendo todo los que tienen CICLO_ROCIADO = 0 a CICLO_ROCIADO = 1 (según javier)\n    cons2006_2009$CICLO_ROCIADO[0 == cons2006_2009$CICLO_ROCIADO] <- 1\n  \n  #Creando la columana STATUS\n    cons2006_2009$STATUS[cons2006_2009$Residual.T==1 | cons2006_2009$Residual.Rec==1] <- 1 #\"T\"\n    cons2006_2009$STATUS[cons2006_2009$Residual.R==1 & is.na(cons2006_2009$STATUS)] <- 2 #\"R\"\n    cons2006_2009$STATUS[cons2006_2009$Residual.C==1 & is.na(cons2006_2009$STATUS)] <- 3 #\"C\"\n    cons2006_2009$STATUS[cons2006_2009$Residual.D==1 & is.na(cons2006_2009$STATUS)] <- 4 #\"DES\"\n    #NOTA: El codigo \"1.25.26.1769\" tiene dos estados: \"C\" y \"Rec\", haremos valer el \"Rec\"\n    #--------------------------------------------------------------------------------------\n    \n    #Completando STATUS con LP  y LV que se encuentran en el campo OBSERVACIONES\n      cons2006_2009$STATUS[is.na(cons2006_2009$STATUS) & grepl(\"P.\",cons2006_2009$OBSERVACIONES, fixed = TRUE)] <- 5 #\"LP\"\n      cons2006_2009$STATUS[is.na(cons2006_2009$STATUS) & (grepl(\"V.\",cons2006_2009$OBSERVACIONES, fixed = TRUE) | grepl(\"LOTE VACIO\",cons2006_2009$OBSERVACIONES))] <- 6 #\"LV\"\n    #Si STATUS = NA y contiene la palabra \"CONSTRUCCIÓN\" o \"NO SE ROCIO\" ponemos C\n      cons2006_2009$STATUS[is.na(cons2006_2009$STATUS) & (grepl(\"CONSTRUCCIÓN\",cons2006_2009$OBSERVACIONES) | grepl(\"NO SE ROCIO\",cons2006_2009$OBSERVACIONES))] <- 3 #\"C\"\n    #Si STATUS = NA y contiene la palabra \"FUE ROCIADA\"\n      cons2006_2009$STATUS[is.na(cons2006_2009$STATUS) & grepl(\"FUE ROCIADA\",cons2006_2009$OBSERVACIONES)] <- 1 #\"T\"\n    #Viviendas que tienen dos UNICODEs\n      cons2006_2009$STATUS[\"1.7.25.193\"== cons2006_2009$UNICODE & 1==cons2006_2009$CICLO] <- 1 #\"T\" # Vivienda 183 es T\n      cons2006_2009$STATUS[\"1.7.25.236\"== cons2006_2009$UNICODE & 1==cons2006_2009$CICLO] <- 1 #\"T\" # Vivienda 194 es T\n      cons2006_2009$STATUS[\"1.7.41.199\"== cons2006_2009$UNICODE & 1==cons2006_2009$CICLO] <- 1 #\"T\" # Vivienda 200 es T\n      cons2006_2009$STATUS[\"1.7.41.238\"== cons2006_2009$UNICODE & 1==cons2006_2009$CICLO] <- 1 #\"T\" # Vivienda 237 es T\n      cons2006_2009$STATUS[\"1.7.41.292\"== cons2006_2009$UNICODE & 1==cons2006_2009$CICLO] <- 1 #\"T\" # Vivienda 291 es T\n      cons2006_2009$STATUS[\"1.7.8A.357\"== cons2006_2009$UNICODE & 1==cons2006_2009$CICLO] <- 1 #\"T\" # Vivienda 356 es T\n      cons2006_2009$STATUS[\"1.7.41.238\"== cons2006_2009$UNICODE & 2==cons2006_2009$CICLO] <- 1 #\"T\" # Vivienda 237 es T\n      cons2006_2009$STATUS[\"1.7.48C.15\"== cons2006_2009$UNICODE & 2==cons2006_2009$CICLO] <- 1 #\"T\" # Vivienda 12 es T\n      #NOTA: Quedan 6 UNICODEs con NA en la columna STATUS\n      #------------------------------------------------------------------------------\n      \n    #Creando la columna POS_CHIRI\n      cons2006_2009$POS_CHIRI[1==cons2006_2009$I_TRIAT | 1==cons2006_2009$P_TRIAT] <- 1\n      cons2006_2009$POS_CHIRI[is.na(cons2006_2009$POS_CHIRI)] <- 0\n    \n    #Seleccionando solo las columna UNICODE, CICLO, STATUS y POS_CHIRI\n      status_cons2006_2009 <- subset(cons2006_2009, select = c(UNICODE, CICLO_ROCIADO, STATUS, POS_CHIRI))\n      status_cons2006_2009 <- unique(status_cons2006_2009)\n      \n    #Utilizando funcion ElimDupliUxS()\n      c1_cons2006_2009 <- ElimDupliUxS(status_cons2006_2009[1 == status_cons2006_2009$CICLO_ROCIADO,])\n      c2_cons2006_2009 <- ElimDupliUxS(status_cons2006_2009[2 == status_cons2006_2009$CICLO_ROCIADO,])\n      \n    #Juntando los dos ciclos en uno solo y SIN NINGUN dato duplicado\n      status_cons2006_2009 <- rbind(c1_cons2006_2009, c2_cons2006_2009)\n   \n  #----   \n  #Acomodando los datos del consolidado 2009-2015 MINSA\n    #Creando la columna STATUS\n        CONS_ROCIADO_2009_2015$STATUS <- \"T\"\n    #Creando columna POS_CHIRI\n        CONS_ROCIADO_2009_2015$POS_CHIRI[is.na(CONS_ROCIADO_2009_2015$IN_TRI) & is.na(CONS_ROCIADO_2009_2015$PE_TRI)] <- 0\n        CONS_ROCIADO_2009_2015$POS_CHIRI[is.na(CONS_ROCIADO_2009_2015$POS_CHIRI)] <- 1\n        C_R_D_LP_LV$POS_CHIRI <- 0\n    #Seleccionando solo las columnas \"UNICODE\", \"CICLO_ROCIADO\", \"STATUS\", \"POS_CHIRI\"\n        status_T <- subset(CONS_ROCIADO_2009_2015, select = c(\"UNICODE\", \"CICLO_ROCIADO\", \"STATUS\", \"POS_CHIRI\"))\n        status_C_R_D_LP_LV <- subset(C_R_D_LP_LV, select = c(\"UNICODE\", \"CICLO_ROCIADO\", \"STATUS\", \"POS_CHIRI\"))\n    #Juntando consolidado 2009 - 2015\n        status_cons2009_2015 <- rbind(status_T, status_C_R_D_LP_LV)\n    #Registros unicos\n        status_cons2009_2015 <- unique(status_cons2009_2015)\n    #Cambiando el STATUS de letras (T, R, C, etct) por numeros de orden de prioridad (T=1, R=2, C=3, etc)\n        status_cons2009_2015$STATUS[\"T\"==status_cons2009_2015$STATUS] <- 1\n        status_cons2009_2015$STATUS[\"R\"==status_cons2009_2015$STATUS] <- 2\n        status_cons2009_2015$STATUS[\"C\"==status_cons2009_2015$STATUS] <- 3\n        status_cons2009_2015$STATUS[\"DES\"==status_cons2009_2015$STATUS] <- 4\n        status_cons2009_2015$STATUS[\"LP\"==status_cons2009_2015$STATUS] <- 5\n        status_cons2009_2015$STATUS[\"LV\"==status_cons2009_2015$STATUS] <- 6\n    #Utilizando funcion ElimDupliUxS()\n        c1_cons2009_2015 <- ElimDupliUxS(status_cons2009_2015[1 == status_cons2009_2015$CICLO_ROCIADO,])\n        c2_cons2009_2015 <- ElimDupliUxS(status_cons2009_2015[2 == status_cons2009_2015$CICLO_ROCIADO,])\n    #Juntando los dos ciclos en uno solo y SIN NINGUN dato duplicado\n        status_cons2009_2015 <- rbind(c1_cons2009_2015, c2_cons2009_2015)\n    \n  #-----      \n  #CONSOLIDADO COMPLETO DESDE EL 2006 HASTA 2015 DEL MINSA CON LAS COLUMNAS: UNICODE, CICLO_ROCIADO, STATUS, POS_CHIRI\n    #Juntando consolidado final \n      STATUS_CONS_2006_2015 <- rbind(status_cons2006_2009, status_cons2009_2015) #181941\n    #Registros unicos\n      STATUS_CONS_2006_2015 <- unique(STATUS_CONS_2006_2015) # 181416, se eliminaron #525\n    #Utilizando funcion ElimDupliUxS()\n      c1_cons2006_2015 <- ElimDupliUxS(STATUS_CONS_2006_2015[1==STATUS_CONS_2006_2015$CICLO_ROCIADO,])\n      c2_cons2006_2015 <- ElimDupliUxS(STATUS_CONS_2006_2015[2==STATUS_CONS_2006_2015$CICLO_ROCIADO,])\n    #Juntando los dos ciclos en uno solo y SIN NINGUN dato duplicado\n      STATUS_CONS_2006_2015 <- rbind(c1_cons2006_2015, c2_cons2006_2015) #181245: se eliminaron 171 registros duplicados\n    #Cambiando los valores de la columna STATUS por T,R,C,DES,LP,LV para que no haya confusiones\n      STATUS_CONS_2006_2015$STATUS[1==STATUS_CONS_2006_2015$STATUS] <- \"T\"\n      STATUS_CONS_2006_2015$STATUS[2==STATUS_CONS_2006_2015$STATUS] <- \"R\"\n      STATUS_CONS_2006_2015$STATUS[3==STATUS_CONS_2006_2015$STATUS] <- \"C\"\n      STATUS_CONS_2006_2015$STATUS[4==STATUS_CONS_2006_2015$STATUS] <- \"DES\"\n      STATUS_CONS_2006_2015$STATUS[5==STATUS_CONS_2006_2015$STATUS] <- \"LP\"\n      STATUS_CONS_2006_2015$STATUS[6==STATUS_CONS_2006_2015$STATUS] <- \"LV\"\n    #Separando por ciclos para poder poner cambiar los nombres de los campos\n      c1_cons2006_2015 <- STATUS_CONS_2006_2015[1==STATUS_CONS_2006_2015$CICLO_ROCIADO,]\n      c2_cons2006_2015 <- STATUS_CONS_2006_2015[2==STATUS_CONS_2006_2015$CICLO_ROCIADO,]\n    #Cambiando los nombres de los campos dependiendo del ciclo al que pertenecen\n      colnames(c1_cons2006_2015) <- c(\"UNICODE\", \"C1\" , \"C1_STATUS\", \"C1_POS_CHIRI\")\n      colnames(c2_cons2006_2015) <- c(\"UNICODE\", \"C2\" , \"C2_STATUS\", \"C2_POS_CHIRI\")\n    #Cambiando el valor de la columna C2 por 1=Presencia o O=Ausencia\n      c2_cons2006_2015$C2 <- 1\n    #Juntando los dos ciclos en un solo registro\n      STATUS_CONS_2006_2015 <- merge(c1_cons2006_2015, c2_cons2006_2015, by = \"UNICODE\", all = TRUE)\n    #Ordenando por UNICODE\n      STATUS_CONS_2006_2015 <- STATUS_CONS_2006_2015[order(STATUS_CONS_2006_2015$UNICODE),]\n      \n#----------------------------------------------------------------------------------------\n# Imprimiendo datos\n#----------------------------------------------------------------------------------------\n  setwd(\"/home/gianfranco/Documentos/github/Participation/bd_minsa/resultados\")\n  write.csv(STATUS_CONS_2006_2015,'STATUS_CONS_2006_2015.csv')\n  write.csv(CONS_ROCIADO_2009_2015,'CONS_ROCIADO_2009_2015.csv')\n  write.csv(statusMinsaASA,'statusMinsaASA.csv')\n  write.csv(tratadas_ASA,'tratadas_ASA.csv')\n  \n  ",
    "created" : 1487387204491.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "168091493",
    "id" : "2D3519D7",
    "lastKnownWriteTime" : 1477096517,
    "last_content_update" : 1477096517,
    "path" : "~/CLAUDIA-DATOS-/claudia codigos r/bd_minsa.R",
    "project_path" : "claudia codigos r/bd_minsa.R",
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}